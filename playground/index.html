<!doctype html><html lang=en-us>
<head>
<meta charset=utf-8>
<meta name=viewport content="width=device-width,initial-scale=1">
<title>
Playground â€” lexy
</title>
<style>:root{--white:white;--header-white:rgba(255, 255, 255, .75);--background-color:#fdfdfd;--default-color:#101010;--heading-color:#0A0A0A;--link-color:#2A2A2A;--gray-highlight-color:#aaaaaa;--highlight-color:#2861ce}@media(prefers-color-scheme:dark){:root{--white:#020202;--header-white:rgba(2, 2, 2, .75);--background-color:#222222;--default-color:#efefef;--heading-color:#f5f5f5;--link-color:#d5d5d5;--gray-highlight-color:#555555}}nav#menu div.menu-container,main{max-width:1200px;margin:0 auto;padding:0 10px}@media(min-width:800px){article{max-width:900px;margin:0 auto;padding:0 10px}}html{position:relative;min-height:100%;margin:0;padding:0}body{font-family:serif;font-size:18px;color:var(--default-color);background-color:var(--background-color);width:100%;padding:0;margin:0}main{margin-bottom:75px}h1,h2,h3,h4,h5,h6{font-family:sans-serif;font-weight:700;line-height:1.15em;color:var(--heading-color);margin:0 0 .4em;hyphens:auto}h1{font-size:2em}h2{font-size:1.75em}h3{font-size:1.5em}h4{font-size:1.25em}h5{font-size:1.15em}h6{font-size:1.1em}a,a svg,button svg{color:var(--link-color);transition:color ease .3s}a:hover,a svg:hover,button svg:hover{color:var(--highlight-color)}a:focus,a svg:focus,button svg:focus{outline:none}br{margin:1em}article p,article ul,article ol,article dl,article td{hyphens:auto;text-align:justify}nav#menu{width:100%;padding:0;background-color:var(--white);border-bottom:2px solid var(--highlight-color);font-family:sans-serif;font-size:1.3em}nav#menu div.menu-container{display:flex}nav#menu div.menu-container ul{display:flex;flex-direction:row;align-items:center;padding:0;list-style:none}nav#menu div.menu-container ul li a{text-decoration:none}nav#menu div.menu-container ul li a svg{height:1em}nav#menu div.menu-container ul li a.active{border-width:0 0 2px;border-style:solid;border-color:var(--highlight-color)}nav#menu div.menu-container ul#home{padding-left:0;padding-right:10px}nav#menu div.menu-container ul#home .title{font-weight:700}nav#menu div.menu-container ul#main{margin-left:auto}nav#menu div.menu-container ul#main li{padding-left:20px}@media(max-width:600px){nav#menu div.menu-container ul#main{flex-direction:column;align-items:flex-end;margin:5px 10px 0 auto}}footer#page-footer{position:absolute;bottom:0;left:0;right:0;height:2em;display:flex;justify-content:space-between;font-size:.8em;font-weight:200;line-height:1em;border-top:1px solid #ccc}footer#page-footer section{padding-left:1em;padding-right:1em;padding-top:.5em;width:100%}footer#page-footer .copyright{text-align:left}footer#page-footer .patreon{text-align:center}footer#page-footer .poweredby{text-align:right}@media(max-width:450px){footer#page-footer{flex-direction:column;align-items:flex-start}footer#page-footer section{text-align:initial!important;width:initial}}aside.toc{display:none}@media(min-width:1100px){aside.toc{display:initial;position:sticky;top:1em;float:left;width:300px}aside.toc header{font-weight:700}aside.toc ul{list-style:none;padding:0}aside.toc ul ul{padding-left:1em;padding-bottom:.5em}aside.toc a{text-decoration:none}aside.toc~article{padding-left:300px}}article header{margin-top:1em;margin-bottom:1em}article header nav{display:flex;flex-wrap:wrap}article header nav a{text-decoration:none;padding-right:7px}article header nav a svg{height:1em;position:relative;top:2px}@media(min-width:700px){article header nav form.search{margin-left:auto}}article header nav form.search input[type=search]{padding:2px;width:250px}article header nav form.search input[type=search]:focus{border-color:var(--highlight-color);outline:solid var(--highlight-color)1px}article header nav form.search button[type=submit]{margin-left:-25px;border:none;background:initial}article header nav form.search button[type=submit] svg{height:1em}article .lead p{font-weight:500;font-size:1.1em}article .admonitionblock{margin-bottom:1em}article .admonitionblock td.icon{font-weight:700}article .admonitionblock td.content div:first-child p{margin-top:0}article .admonitionblock td.content div:last-child p{margin-bottom:0}@media(max-width:600px){article .admonitionblock tr{display:block;float:left;padding-left:.5em;padding-right:.5em}article .admonitionblock tr td{display:block}}@media(min-width:600px){article .admonitionblock td.icon{width:75px;text-align:center;border-right:1px solid var(--gray-highlight-color)}article .admonitionblock td.content{padding-left:.5em}}article .exampleblock{margin-top:1em;margin-bottom:1em}article .exampleblock .title{font-style:italic}article a.github-example{text-decoration:none}article a.github-example svg{height:.8em;position:relative;top:2px}article .playground-example .title,article .godbolt-example .title{position:relative}article .playground-example .title a,article .godbolt-example .title a{position:absolute;top:7px;right:7px}article .playground-example .title a svg,article .godbolt-example .title a svg{height:1em}article details{margin-bottom:1em}article details summary{font-style:italic}article ul p,article ol p{margin:.2em}article div ul:not(:first-child),article div ol:not(:first-child){margin-top:0}article dl dt{margin-top:.5em;font-weight:700}article dl dd p,article dl dd div:only-child ul{margin:0;padding:0}article div dl:not(:first-child){margin-top:0}article table.tableblock{background:var(--white);margin:0 auto;border-collapse:collapse}article table.tableblock td,article table.tableblock th{border:1px solid var(--gray-highlight-color);padding:5px;text-align:left}article table.tableblock td p,article table.tableblock th p{margin:0}article div.sidebarblock{border:1px solid var(--gray-highlight-color);padding:.75em;margin:1em}article div.sidebarblock p{margin:0}article code{font-family:Inconsolata,monospace,sans-serif}article pre{margin:0;overflow:auto;padding:10px;background:var(--white);border:1px solid var(--gray-highlight-color);line-height:1.1}article .colist{margin-top:-.5em}article .colist ol{counter-reset:list}article .colist ol li{counter-increment:list;padding-left:1em}article .colist ol ::marker{content:"(" counter(list)")";font-weight:700}article .colist p{margin:0}.highlight .tok-c,.highlight .tok-cm,.highlight .tok-cp,.highlight .tok-c1,.highlight .tok-cs,.ace_editor .tok-c,.ace_editor .tok-cm,.ace_editor .tok-cp,.ace_editor .tok-c1,.ace_editor .tok-cs{color:#998;font-style:italic;font-weight:initial}.highlight .tok-k,.highlight .tok-kc,.highlight .tok-kd,.highlight .tok-kp,.highlight .tok-kr,.highlight .tok-kt,.highlight .ace_storage,.highlight .ace_keyword,.ace_editor .tok-k,.ace_editor .tok-kc,.ace_editor .tok-kd,.ace_editor .tok-kp,.ace_editor .tok-kr,.ace_editor .tok-kt,.ace_editor .ace_storage,.ace_editor .ace_keyword{color:#458;font-style:initial;font-weight:700}.highlight .tok-o,.highlight .tok-p,.highlight .ace_keyword.ace_operator,.highlight .ace_paren,.highlight .ace_punctuation,.ace_editor .tok-o,.ace_editor .tok-p,.ace_editor .ace_keyword.ace_operator,.ace_editor .ace_paren,.ace_editor .ace_punctuation{color:red;font-style:initial;font-weight:initial}.highlight .ace_dsl,.ace_editor .ace_dsl{text-decoration:underline;cursor:pointer;pointer-events:auto}.highlight .tok-m,.highlight .tok-mf,.highlight .tok-mh,.highlight .tok-mi,.highlight .tok-mo,.highlight .ace_constant,.ace_editor .tok-m,.ace_editor .tok-mf,.ace_editor .tok-mh,.ace_editor .tok-mi,.ace_editor .tok-mo,.ace_editor .ace_constant{color:#ff8000;font-style:initial;font-weight:initial}.highlight .tok-s,.highlight .tok-sb,.highlight .tok-sc,.highlight .tok-sd,.highlight .tok-s2,.highlight .tok-s3,.highlight .tok-sh,.highlight .tok-si,.highlight .tok-sx,.highlight .tok-sr,.highlight .tok-s1,.highlight .tok-ss,.highlight .tok-se,.highlight .ace_string,.ace_editor .tok-s,.ace_editor .tok-sb,.ace_editor .tok-sc,.ace_editor .tok-sd,.ace_editor .tok-s2,.ace_editor .tok-s3,.ace_editor .tok-sh,.ace_editor .tok-si,.ace_editor .tok-sx,.ace_editor .tok-sr,.ace_editor .tok-s1,.ace_editor .tok-ss,.ace_editor .tok-se,.ace_editor .ace_string{color:green;font-style:initial;font-weight:initial}.highlight .tok-cp,.ace_editor .tok-cp{color:green;font-style:initial;font-weight:700}.highlight .tok-err,.highlight .ace_invalid,.ace_editor .tok-err,.ace_editor .ace_invalid{color:red;font-style:initial;font-weight:initial}.highlight strong,.ace_editor strong{font-weight:initial}.highlight strong:not(:empty)::before,.ace_editor strong:not(:empty)::before{content:"*";color:red}.highlight strong:not(:empty)::after,.ace_editor strong:not(:empty)::after{content:"*";color:red}</style>
</head>
<body>
<nav id=menu>
<div class=menu-container>
<ul id=home>
<li>
<a href=/>
<span class=title>lexy:</span> C++ parser combinator library
</a>
</li>
</ul>
<ul id=main><li>
<a href=/tutorial/>Tutorial</a>
</li><li>
<a href=/reference/>Reference</a>
</li><li>
<a class=active href=/playground/>Playground</a>
</li><li>
<a href=https://github.com/foonathan/lexy title=GitHub><svg aria-hidden="true" focusable="false" data-prefix="fab" data-icon="github" class="svg-inline--fa fa-github fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path fill="currentcolor" d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6.0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6.0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3.0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1.0-6.2-.3-40.4-.3-61.4.0.0-70 15-84.7-29.8.0.0-11.4-29.1-27.8-36.6.0.0-22.9-15.7 1.6-15.4.0.0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5.0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9.0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4.0 33.7-.3 75.4-.3 83.6.0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6.0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9.0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
</a>
</li>
</ul>
</div>
</nav>
<section id=playground>
<section id=toolbar>
<div class=toolbar-editor-options>
<select id=toolbar-examples><option selected disabled hidden>Load example</option><option value=/playground/alternative.cpp>
alternative
</option><option value=/playground/any.cpp>
any
</option><option value=/playground/choice.cpp>
choice
</option><option value=/playground/choice_branch.cpp>
choice_branch
</option><option value=/playground/choice_else.cpp>
choice_else
</option><option value=/playground/choice_error.cpp>
choice_error
</option><option value=/playground/choice_error_range.cpp>
choice_error_range
</option><option value=/playground/choice_production.cpp>
choice_production
</option><option value=/playground/code_point.cpp>
code_point
</option><option value=/playground/code_point_if.cpp>
code_point_if
</option><option value=/playground/combination.cpp>
combination
</option><option value=/playground/context_counter.cpp>
context_counter
</option><option value=/playground/context_flag.cpp>
context_flag
</option><option value=/playground/context_identifier.cpp>
context_identifier
</option><option value=/playground/cpp_comment.cpp>
cpp_comment
</option><option value=/playground/default.cpp>
default
</option><option value=/playground/digit.cpp>
digit
</option><option value=/playground/digits.cpp>
digits
</option><option value=/playground/do_while.cpp>
do_while
</option><option value=/playground/eof.cpp>
eof
</option><option value=/playground/eol.cpp>
eol
</option><option value=/playground/equal_counts.cpp>
equal_counts
</option><option value=/playground/exhausted_choice.cpp>
exhausted_choice
</option><option value=/playground/expected_char_class.cpp>
expected_char_class
</option><option value=/playground/expected_literal.cpp>
expected_literal
</option><option value=/playground/find.cpp>
find
</option><option value=/playground/identifier.cpp>
identifier
</option><option value=/playground/if.cpp>
if
</option><option value=/playground/inline.cpp>
inline
</option><option value=/playground/keyword.cpp>
keyword
</option><option value=/playground/lit.cpp>
lit
</option><option value=/playground/lit_ascii.cpp>
lit_ascii
</option><option value=/playground/lit_utf8.cpp>
lit_utf8
</option><option value=/playground/loop.cpp>
loop
</option><option value=/playground/manual_whitespace.cpp>
manual_whitespace
</option><option value=/playground/minus_any.cpp>
minus_any
</option><option value=/playground/minus_sign.cpp>
minus_sign
</option><option value=/playground/must.cpp>
must
</option><option value=/playground/n_digits.cpp>
n_digits
</option><option value=/playground/newline.cpp>
newline
</option><option value=/playground/no_trailing.cpp>
no_trailing
</option><option value=/playground/no_whitespace.cpp>
no_whitespace
</option><option value=/playground/parenthesized.cpp>
parenthesized
</option><option value=/playground/partial_combination.cpp>
partial_combination
</option><option value=/playground/peek.cpp>
peek
</option><option value=/playground/peek_not.cpp>
peek_not
</option><option value=/playground/plus_sign.cpp>
plus_sign
</option><option value=/playground/position.cpp>
position
</option><option value=/playground/quoted.cpp>
quoted
</option><option value=/playground/quoted_error.cpp>
quoted_error
</option><option value=/playground/quoted_limit.cpp>
quoted_limit
</option><option value=/playground/quoted_token.cpp>
quoted_token
</option><option value=/playground/recover.cpp>
recover
</option><option value=/playground/recurse.cpp>
recurse
</option><option value=/playground/reserved_identifier.cpp>
reserved_identifier
</option><option value=/playground/return.cpp>
return
</option><option value=/playground/terminator.cpp>
terminator
</option><option value=/playground/terminator_list.cpp>
terminator_list
</option><option value=/playground/terminator_opt.cpp>
terminator_opt
</option><option value=/playground/terminator_recovery.cpp>
terminator_recovery
</option><option value=/playground/terminator_try.cpp>
terminator_try
</option><option value=/playground/trace.cpp>
trace
</option><option value=/playground/while.cpp>
while
</option><option value=/playground/while_one.cpp>
while_one
</option><option value=/playground/whitespace.cpp>
whitespace
</option><option value=/playground/whitespace_comment.cpp>
whitespace_comment
</option><option value=/playground/whitespace_determination.cpp>
whitespace_determination
</option><option value=/playground/zero.cpp>
zero
</option></select>
<button id=toolbar-permalink title="Create a permalink to this example.">Permalink</button>
<input type=checkbox id=toolbar-vim>
<label for=toolbar-vim title="Enable/disable vim bindings.">Vim</label>
<input type=checkbox id=toolbar-wrap checked>
<label for=toolbar-wrap title="Enable/disable word wrap.">Wrap</label>
</div>
<div class=toolbar-run-options>
<label for=toolbar-production>Entry production:</label>
<select id=toolbar-production></select>
<select id=toolbar-mode><option value=tree selected>Parse Tree</option><option value=trace>Trace</option></select>
<button id=toolbar-run type=button>Run</button>
<button id=toolbar-godbolt type=button>
<img src=https://godbolt.org/favicon.ico alt="CE logo" title="View on Compiler Explorer.">
</button>
</div>
</section>
<section id=editors>
<div class=editor-container>
<div class=editor id=editor-grammar></div>
</div>
<div class=editor-container>
<div class=editor id=editor-input></div>
</div>
</section>
<section id=output>
<div class=output-container id=output-graph></div>
<div class=output-container id=output-text></div>
</section>
<section>
<p>Enter the grammar in the left editor (<code>lexy/dsl.hpp</code> and namespace alias <code>dsl</code> is pre-included) and the input in the right editor.
The result of parsing the selected entry production on that input is displayed in the bottom window.
The encoding is <code>lexy::utf8_encoding</code>.</p>
<p>The online playground is powered by <a href=https://godbolt.org/>Compiler Explorer</a>, <a href=https://ace.c9.io/>Ace</a>, <a href=https://github.com/drudru/ansi_up>ansi_up</a>, and <a href=https://github.com/magjac/d3-graphviz>d3-graphviz</a>.</p>
</section>
<style>:root{--white:white;--header-white:rgba(255, 255, 255, .75);--background-color:#fdfdfd;--default-color:#101010;--heading-color:#0A0A0A;--link-color:#2A2A2A;--gray-highlight-color:#aaaaaa;--highlight-color:#2861ce}@media(prefers-color-scheme:dark){:root{--white:#020202;--header-white:rgba(2, 2, 2, .75);--background-color:#222222;--default-color:#efefef;--heading-color:#f5f5f5;--link-color:#d5d5d5;--gray-highlight-color:#555555}}nav#menu div.menu-container{max-width:initial}#playground{padding:1em}#toolbar{display:flex;justify-content:space-between;align-items:baseline;margin-bottom:1em}#toolbar input[type=checkbox]{vertical-align:middle}#toolbar select,#toolbar button{background-color:var(--white);border:1px solid var(--gray-highlight-color);border-radius:3px;padding:5px}#toolbar #toolbar-godbolt img{height:1em}#editors{display:flex;flex-wrap:wrap;margin-bottom:5px}#editors .editor-container{flex:1;min-width:30em;height:30em;border:1px solid var(--gray-highlight-color);margin:5px}#editors .editor{position:relative;width:100%;height:100%}#output{display:flex;flex-wrap:wrap;margin-bottom:5px}#output .output-container{flex:1;min-width:30em;border:1px solid var(--gray-highlight-color);padding:2px 5px;margin:5px}#output #output-text{font-family:monospace;white-space:pre-wrap}#output #output-graph{display:none}#output #output-graph svg{width:100%}</style>
<script src=https://cdnjs.cloudflare.com/ajax/libs/ace/1.4.12/ace.js></script>
<script src=https://cdnjs.cloudflare.com/ajax/libs/ace/1.4.12/ext-language_tools.min.js></script>
<script src=https://d3js.org/d3.v5.min.js></script>
<script src=https://unpkg.com/@hpcc-js/wasm@0.3.11/dist/index.min.js></script>
<script src=https://unpkg.com/d3-graphviz@3.0.5/build/d3-graphviz.js></script>
<script src=https://cdn.jsdelivr.net/gh/drudru/ansi_up@v5.0.1/ansi_up.js></script>
<script type=module>
import * as playground from "https:\/\/lexy.foonathan.net\/playground.min.js";

const toolbar_examples   = document.getElementById("toolbar-examples");
const toolbar_permalink  = document.getElementById("toolbar-permalink");
const toolbar_vim        = document.getElementById("toolbar-vim");
const toolbar_wrap       = document.getElementById("toolbar-wrap");
const toolbar_production = document.getElementById("toolbar-production");
const toolbar_mode       = document.getElementById("toolbar-mode");
const toolbar_run        = document.getElementById("toolbar-run");
const toolbar_godbolt    = document.getElementById("toolbar-godbolt");

const editor_grammar = ace.edit("editor-grammar");
const editor_input   = ace.edit("editor-input");

const output_text  = document.getElementById("output-text");
const output_graph = document.getElementById("output-graph");

function update_toolbar_production(selected_production)
{
    const source      = editor_grammar.getValue();
    const productions = playground.list_of_productions(source);

    if (selected_production === undefined)
        selected_production = toolbar_production.value;

    
    toolbar_production.innerHTML = '';
    for (var prod of productions)
    {
        var option = document.createElement("option");
        option.value = prod;
        option.innerHTML = `<code>${prod}</code>`;
        option.selected = (prod == selected_production);

        toolbar_production.appendChild(option);
    }
}

async function load()
{
    const storage = window.sessionStorage;
    const params = new URLSearchParams(window.location.search);

    var result = {};

    const id      = params.get('id');
    const example = params.get('example');
    if (id !== null)
    {
        result = await playground.load_godbolt_url(id);
    }
    else if (example !== null)
    {
        for (var option of toolbar_examples.options)
        {
            if (option.text !== example)
                continue;

            option.selected = true;
            result = await playground.load_example(option.value);
            break;
        }
    }
    else if (toolbar_examples.selectedIndex > 0)
    {
        result = await playground.load_example(toolbar_examples.value);
    }
    else
    {
        // Load session entry or default.
        var def = await playground.load_example("\/playground\/default.cpp");
        result.grammar    = storage.getItem('editor-grammar') || def.grammar;
        result.input      = storage.getItem('editor-input') || def.input;
        result.production = storage.getItem('toolbar-production') || def.production;
    }

    const mode = params.get('mode');
    result.mode = mode || storage.getItem('toolbar-mode') || 'tree';

    editor_grammar.setValue(result.grammar, 1);
    editor_input.setValue(result.input, 1);
    update_toolbar_production(result.production);
    toolbar_mode.value = result.mode;
}

function save()
{
    const storage = window.sessionStorage;

    
    window.history.replaceState({}, document.title, "https://lexy.foonathan.net/playground/");
    toolbar_examples.selectedIndex = 0;

    
    storage.setItem('editor-grammar', editor_grammar.getValue());
    storage.setItem('editor-input', editor_input.getValue());
    storage.setItem('toolbar-production', toolbar_production.value);
    storage.setItem('toolbar-mode', toolbar_mode.value);
}

function toggle_vim()
{
    for (var editor of [editor_grammar, editor_input])
    {
        if (toolbar_vim.checked)
            editor.setKeyboardHandler("ace/keyboard/vim");
        else
            editor.setKeyboardHandler("");
    }
}
function toggle_wrap()
{
    for (var editor of [editor_grammar, editor_input])
        editor.getSession().setUseWrapMode(toolbar_wrap.checked);
}

async function run()
{
    toolbar_run.disabled = true;

    const source = await playground.preprocess_source('playground', editor_grammar.getValue(), toolbar_production.value);
    const input  = editor_input.getValue();
    const mode = toolbar_mode.value;
    console.log(mode);

    const result = await playground.compile_and_run(source, input, mode);
    const ansi_up = new AnsiUp;
    if (result.success)
    {
        if (mode == 'tree')
        {
            console.log(result.code);
            if (result.code == 0) 
            {
                d3.select(output_graph).graphviz().renderDot(result.stdout);
                output_text.style.display = "none";
                output_graph.style.display = "block";
            }
            else if (result.code == 1) 
            {
                d3.select(output_graph).graphviz().renderDot(result.stdout);
                output_text.innerHTML = ansi_up.ansi_to_html(result.stderr);
                output_text.style.display = "block";
                output_graph.style.display = "block";
            }
            else  
            {
                output_text.innerHTML = ansi_up.ansi_to_html(result.stderr);
                output_text.style.display = "block";
                output_graph.style.display = "none";
            }
        }
        else
        {
            output_text.innerHTML = ansi_up.ansi_to_html(result.stdout);
            output_text.style.display = "block";
            output_graph.style.display = "none";
        }
    }
    else
    {
        output_text.innerHTML = ansi_up.ansi_to_html(result.message);
        output_text.style.display = "block";
        output_graph.style.display = "none";
    }

    toolbar_run.disabled = false;
}

function debounce(func, delay)
{
    var timeout;
    return function() {
        clearTimeout(timeout);
        timeout = setTimeout(func, delay);
    };
}

window.addEventListener('load', async() => {
    const doc_entities = await (await fetch("/reference/index.json")).json();
    ace.require("ace/ext/language_tools");

    editor_grammar.session.setMode("ace/mode/c_cpp", function() {
        var session = editor_grammar.session;

        
        var rules = session.$mode.$highlightRules.getRules();
        rules['start'].unshift({
            token: 'dsl',
            
            
            
            regex: '(lexy::)?dsl::[a-z0-9_]+(::[a-z0-9_]+)*|LEXY_[A-Z0-9_]+'
        });

        
        session.$mode.$tokenizer = null;
        session.bgTokenizer.setTokenizer(session.$mode.getTokenizer());
    });
    editor_grammar.setShowPrintMargin(false);
    editor_grammar.setOptions({
        enableBasicAutocompletion: true,
        enableLiveAutocompletion: true
    });
    editor_grammar.completers.push({
        getCompletions: function(editor, session, pos, prefix, callback) {
            var completions = [];
            for (let name in doc_entities) {
                if (name.startsWith("lexy::dsl"))
                    completions.push({ value: name.replace(/^lexy::/, ''), meta: 'lexy' });
                else if (name.startsWith("lexy_"))
                    completions.push({ value: name.toUpperCase(), meta: 'lexy' });
            }
            callback(null, completions);
        }
    });
    editor_grammar.on('click', function(){
        const pos    = editor_grammar.getCursorPosition();
        const token = editor_grammar.session.getTokenAt(pos.row, pos.column);
        if (token.type !== 'dsl')
            return;
        const identifier = token.value.toLowerCase();

        let url = doc_entities[identifier] ?? doc_entities['lexy::' + identifier];
        if (url)
            window.location.href = url;
    });

    editor_input.setTheme("ace/theme/github");
    editor_input.session.setMode("ace/mode/text");
    editor_input.setShowPrintMargin(false);

    
    editor_grammar.getSession().on('change', debounce(save, 1000));
    editor_input.getSession().on('change', debounce(save, 1000));
    toolbar_production.addEventListener('change', save);

    
    editor_grammar.getSession().on('change', debounce(update_toolbar_production, 1000));

    
    editor_grammar.getSession().on('change', debounce(run, 1000));
    editor_input.getSession().on('change', debounce(run, 1000));
    toolbar_production.addEventListener('change', run);

    
    toolbar_examples.addEventListener('change', load);
    toolbar_permalink.addEventListener('click', async() => {
        const source = await playground.preprocess_source('godbolt', editor_grammar.getValue(), toolbar_production.value);
        const input  = editor_input.getValue();

        const url = await playground.get_godbolt_permalink(source, input);
        const id = url.substring(url.lastIndexOf('/') + 1);
        window.history.replaceState({}, document.title, "https:\/\/lexy.foonathan.net\/playground\/?id=" + id + "&mode=" + toolbar_mode.value);
    });
    toolbar_vim.addEventListener('click', toggle_vim);
    toolbar_wrap.addEventListener('click', toggle_wrap);
    toolbar_run.addEventListener('click', run);
    toolbar_godbolt.addEventListener('click', async() => {
        const source = await playground.preprocess_source('godbolt', editor_grammar.getValue(), toolbar_production.value);
        const input  = editor_input.getValue();
        window.location.href = await playground.get_godbolt_url(source, input);
    });

    
    await load();
    toggle_vim();
    toggle_wrap();
    run();
});
</script>
<footer id=page-footer>
<section class=copyright>
&copy; <a target=_blank href=https://github.com/foonathan/lexy/blob/main/LICENSE title=License>2020-2021</a>
</section>
<section class=patreon>
<a target=_blank href=https://jonathanmueller.dev/support-me/>Support me!</a>
</section>
<section class=poweredby>
Made with <a target=_blank href=https://gohugo.io>Hugo</a> and <a target=_blank href=https://fontawesome.com/license>Font Awesome</a>.
</section>
</footer>
</body>
</html>